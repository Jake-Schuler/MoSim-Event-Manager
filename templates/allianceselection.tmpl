<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/static/dark-theme.css">
    <title>{{ .title }}</title>
    <link rel="icon" type="image/x-icon" href="/static/static/favicon.png">
</head>
<body>
    <div class="container">
        <h1>ü§ù Alliance Selection</h1>
        
        <div class="nav-buttons">
            <a href="/admin/" class="btn">‚Üê Back to Admin</a>
            <button id="toggleAllianceSelection" class="btn">Toggle Alliance Selection</button>
            <burn id="resetAllianceSelections" class="btn">Reset Alliance Selections</burn>
            <button id="timer" class="btn">Start Timer</button>
        </div>
        <!-- Alliance Forms -->
        <div id="alliances-container" class="forms-grid">
            <!-- Forms will be injected here -->
        </div>
        
        <div id="success-message" class="message success" style="display: none;">
            Alliance selection saved successfully!
        </div>
    </div>
    <script>
        // Generate 8 alliance forms dynamically
        const alliancesContainer = document.getElementById('alliances-container');
        for (let i = 1; i <= 8; i++) {
            const formDiv = document.createElement('div');
            formDiv.className = 'alliance-form';
            formDiv.innerHTML = `
                <h3>üèÜ Alliance ${i}</h3>
                <form class="alliance alliance-${i}">
                    <label for="alliance-${i}-captain">Alliance Captain:</label>
                    <input type="text" id="alliance-${i}-captain" name="alliance-${i}-captain" placeholder="Enter captain's name" autocomplete="off">
                    
                    <label for="alliance-${i}-selection">Alliance Selection:</label>
                    <input type="text" id="alliance-${i}-selection" name="alliance-${i}-selection" placeholder="Enter selected name" autocomplete="off">
                    
                    <button type="submit">üíæ Save Alliance ${i}</button>
                </form>
            `;
            alliancesContainer.appendChild(formDiv);
        }

        // Add event listeners for all alliance forms
        for (let i = 1; i <= 8; i++) {
            document.querySelector(`.alliance-${i}`).addEventListener('submit', function(event) {
                event.preventDefault();
                const captain = document.getElementById(`alliance-${i}-captain`).value;
                const selection = document.getElementById(`alliance-${i}-selection`).value;
                
                if (!captain.trim()) {
                    alert('Please enter a captain team number');
                    return;
                }
                
                fetch('/admin/allianceSelection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        alliance: i,
                        captain: captain,
                        selection: selection
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        const successMessage = document.getElementById('success-message');
                        successMessage.style.display = 'block';
                        setTimeout(() => {
                            successMessage.style.display = 'none';
                        }, 3000);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error saving alliance selection');
                });
            });
        }

        function toggleAllianceSelection() {
            fetch('/admin/toggle_alliance_selection', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                window.location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }

        document.getElementById('toggleAllianceSelection').addEventListener('click', toggleAllianceSelection);

        // Timer functionality
        let timeLeft = 30;
        let timerInterval = null;
        let isRunning = false;
        
        function updateTimerDisplay() {
            const timerButton = document.getElementById('timer');
            if (isRunning) {
                timerButton.textContent = `‚è∞ ${timeLeft}s`;
            } else {
                timerButton.textContent = timeLeft === 30 ? 'Start Timer' : `‚è∏Ô∏è Paused (${timeLeft}s)`;
            }
        }
        
        function startTimer() {
            isRunning = true;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    // Timer finished
                    clearInterval(timerInterval);
                    isRunning = false;
                    timeLeft = 30;
                    updateTimerDisplay();
                    alert('‚è∞ Time\'s up!');
                }
            }, 1000);
        }
        
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            isRunning = false;
            timeLeft = 30;
            updateTimerDisplay();
        }
        
        document.getElementById('timer').addEventListener('click', function() {
            if (isRunning) {
                // If running, stop and reset
                stopTimer();
            } else {
                // If not running, start the timer
                if (timeLeft !== 30) {
                    // If paused, reset first
                    timeLeft = 30;
                }
                startTimer();
            }
        });
        
        // Initialize timer display
        updateTimerDisplay();

        document.getElementById('resetAllianceSelections').addEventListener('click', function() {
            fetch('/admin/reset_alliance_selections', {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                window.location.reload();
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>